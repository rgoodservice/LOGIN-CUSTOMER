<!DOCTYPE html>
<html lang="th"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Timeline (Supabase)</title>
<style>
  body{font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;background:#0f172a;color:#f1f5f9;margin:0;padding:24px}
  .item{display:flex;align-items:flex-start;gap:10px;margin-bottom:14px}
  .dot{width:12px;height:12px;border-radius:50%;background:#3b82f6;flex-shrink:0;margin-top:6px}
  .card{background:#111827;padding:12px;border-radius:12px;flex:1;border:1px solid #334155}
  .title{font-weight:700}
  .meta{color:#94a3b8;font-size:12px}
  .badge{display:inline-block;margin-top:4px;padding:2px 8px;border-radius:8px;font-size:12px;background:#1f2937}
  .state-success .dot{background:#10b981}.state-success .badge{background:#10b981;color:#fff}
  .state-danger .dot{background:#ef4444}.state-danger .badge{background:#ef4444;color:#fff}
  .state-pending .dot{background:#f59e0b}.state-pending .badge{background:#f59e0b;color:#111}
  .admin-only{display:none}
</style>
</head><body>
<h2>Timeline (Supabase)</h2>
<div id="timeline"></div>

<div style="margin-top:16px">
  <input id="newText" placeholder="เพิ่มเหตุการณ์" style="padding:8px;border-radius:8px;border:1px solid #334155;background:#0b1220;color:#f1f5f9">
  <select id="newStatus" style="padding:8px;border-radius:8px;background:#0b1220;color:#f1f5f9">
    <option value="pending">รอ</option>
    <option value="success">ผ่าน</option>
    <option value="danger">ตีกลับ</option>
  </select>
  <button class="btn admin-only" id="btnAdd">เพิ่ม</button>
</div>

<div style="margin-top:12px">
  <button class="btn" id="btnLogin">เข้าสู่ระบบ (แอดมิน)</button>
  <button class="btn admin-only" id="btnLogout">ออกจากระบบ</button>
</div>
<div id="authBox" style="margin-top:16px;display:none;">
  <input id="email" placeholder="อีเมล" style="padding:8px;border-radius:8px;border:1px solid #334155;background:#0b1220;color:#f1f5f9">
  <input id="password" type="password" placeholder="รหัสผ่าน" style="padding:8px;border-radius:8px;border:1px solid #334155;background:#0b1220;color:#f1f5f9">
  <button class="btn primary" id="btnDoLogin">ล็อกอิน</button>
</div>

<script type="module">
  import { supa, setAdminUI, login, logout, mountTimeline } from './supabase-adapter.js';
  const params = new URLSearchParams(location.search);
  const caseCode = params.get('case') || 'RG-AG-0002/2025';
  mountTimeline(caseCode);

  document.getElementById('btnLogin').addEventListener('click', ()=>{
    document.getElementById('authBox').style.display='block';
  });
  document.getElementById('btnDoLogin').addEventListener('click', async()=>{
    const email = document.getElementById('email').value;
    const pw = document.getElementById('password').value;
    try{ await login(email,pw); setAdminUI(true); alert('เข้าสู่ระบบแล้ว'); }
    catch(e){ alert('ผิดพลาด: '+e.message); }
  });
  document.getElementById('btnLogout').addEventListener('click', async()=>{
    await logout(); setAdminUI(false);
  });
  document.getElementById('btnAdd').addEventListener('click', async()=>{
    const text = document.getElementById('newText').value;
    const st = document.getElementById('newStatus').value;
    try{ await window.timelineActions.add(text, st); document.getElementById('newText').value=''; }
    catch(e){ alert('ผิดพลาด: '+e.message); }
  });
</script>
</body></html>
