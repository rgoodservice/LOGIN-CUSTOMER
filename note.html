<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>à¸«à¸¡à¸²à¸¢à¹€à¸«à¸•à¸¸à¸ªà¸–à¸²à¸™à¸°à¹€à¸­à¸à¸ªà¸²à¸£ â€” R.Good Service</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<link href="https://fonts.googleapis.com/css2?family=Prompt:wght@400;600;700&display=swap" rel="stylesheet">

<style>
  :root{
    --bg:#f9fafb;
    --card:#ffffff;
    --border:#e5e7eb;
    --text:#0f172a;
    --muted:#64748b;
    --accent:#0ea5a5;
    --warn:#b45309;
    --danger:#b91c1c;
    --ok:#047857;
    --radius:14px;

    /* à¸ªà¸µà¸à¸·à¹‰à¸™à¸«à¸¥à¸±à¸‡à¸ªà¸–à¸²à¸™à¸°à¹à¸¢à¸à¸à¸±à¸™ */
    --bg-inprog:#fff8e1;  /* à¹€à¸«à¸¥à¸·à¸­à¸‡à¸­à¹ˆà¸­à¸™ */
    --bg-done:#ecfdf5;    /* à¹€à¸‚à¸µà¸¢à¸§à¸­à¹ˆà¸­à¸™ */
    --bg-stop:#ffecec;    /* à¹à¸”à¸‡à¸­à¹ˆà¸­à¸™ */
  }
  *{box-sizing:border-box;}
  body{
    margin:0;
    font-family:"Prompt",sans-serif;
    color:var(--text);
    background:var(--bg);
  }
  header{
    padding:20px;
    background:linear-gradient(135deg,#e0f7f5,#f0fdfa);
    border-bottom:1px solid var(--border);
    display:flex;
    align-items:center;
    justify-content:space-between;
  }
  .logo{font-weight:700;font-size:20px;color:var(--accent);}
  main{
    max-width:1000px;
    margin:30px auto;
    padding:0 16px;
  }
  .card{
    background:var(--card);
    border:1px solid var(--border);
    border-radius:var(--radius);
    padding:20px;
    margin-bottom:16px;
    box-shadow:0 3px 10px rgba(0,0,0,.05);
  }
  h2{margin-top:0;font-size:20px;color:var(--accent);}
  table{width:100%;border-collapse:collapse;font-size:15px;}
  th,td{padding:10px;border-bottom:1px solid var(--border);vertical-align:top;}
  th{background:#f1f5f9;text-align:left;}
  tr[data-status="à¸­à¸¢à¸¹à¹ˆà¸£à¸°à¸«à¸§à¹ˆà¸²à¸‡à¸”à¸³à¹€à¸™à¸´à¸™à¸à¸²à¸£"]{background:var(--bg-inprog);}
  tr[data-status="à¸”à¸³à¹€à¸™à¸´à¸™à¸à¸²à¸£à¹à¸¥à¹‰à¸§"]{background:var(--bg-done);}
  tr[data-status="à¹„à¸¡à¹ˆà¸•à¹ˆà¸­à¸­à¸²à¸¢à¸¸à¹à¸¥à¹‰à¸§"]{background:var(--bg-stop);}
  .note{color:var(--muted);font-size:13px;}
  .status{font-weight:600;padding:4px 8px;border-radius:8px;display:inline-block;}
  .status[data-status="à¸­à¸¢à¸¹à¹ˆà¸£à¸°à¸«à¸§à¹ˆà¸²à¸‡à¸”à¸³à¹€à¸™à¸´à¸™à¸à¸²à¸£"]{background:#fff7ed;color:var(--warn);}
  .status[data-status="à¹„à¸¡à¹ˆà¸•à¹ˆà¸­à¸­à¸²à¸¢à¸¸à¹à¸¥à¹‰à¸§"]{background:#fef2f2;color:var(--danger);}
  .status[data-status="à¸”à¸³à¹€à¸™à¸´à¸™à¸à¸²à¸£à¹à¸¥à¹‰à¸§"]{background:#ecfdf5;color:var(--ok);}
  .filter-bar{
    display:flex;
    gap:10px;
    align-items:center;
    margin-bottom:16px;
  }
  select{
    padding:8px 12px;
    border-radius:10px;
    border:1px solid var(--border);
    font-family:"Prompt";
    font-size:14px;
  }
</style>
</head>
<body>
  <header>
    <div class="logo">ğŸ“ à¸«à¸¡à¸²à¸¢à¹€à¸«à¸•à¸¸à¸ªà¸–à¸²à¸™à¸°à¹€à¸­à¸à¸ªà¸²à¸£</div>
    <button onclick="window.close()" style="padding:8px 14px;border:1px solid var(--border);background:white;border-radius:10px;cursor:pointer;">à¸›à¸´à¸”à¸«à¸™à¹‰à¸²à¸™à¸µà¹‰</button>
  </header>

  <main>
    <div class="card">
      <h2>à¸£à¸²à¸¢à¸à¸²à¸£à¸ªà¸–à¸²à¸™à¸°à¹à¸¥à¸°à¸«à¸¡à¸²à¸¢à¹€à¸«à¸•à¸¸</h2>
      <div id="companyName" class="note"></div>

      <div class="filter-bar">
Â  Â  Â  Â  <label for="statusFilter">à¸à¸£à¸­à¸‡à¸•à¸²à¸¡à¸ªà¸–à¸²à¸™à¸°:</label>
Â  Â  Â  Â  <select id="statusFilter">
Â  Â  Â  Â  Â  <option value="à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”">à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸” (à¸ªà¸–à¸²à¸™à¸°à¸•à¹ˆà¸­à¸­à¸²à¸¢à¸¸)</option>
Â  Â  Â  Â  Â  <option value="à¸”à¸³à¹€à¸™à¸´à¸™à¸à¸²à¸£à¸£à¸§à¸¡">à¸”à¸³à¹€à¸™à¸´à¸™à¸à¸²à¸£à¹à¸¥à¹‰à¸§ + à¸­à¸¢à¸¹à¹ˆà¸£à¸°à¸«à¸§à¹ˆà¸²à¸‡à¸”à¸³à¹€à¸™à¸´à¸™à¸à¸²à¸£</option>
Â  Â  Â  Â  Â  <option value="à¸­à¸¢à¸¹à¹ˆà¸£à¸°à¸«à¸§à¹ˆà¸²à¸‡à¸”à¸³à¹€à¸™à¸´à¸™à¸à¸²à¸£">à¹€à¸‰à¸à¸²à¸°à¸­à¸¢à¸¹à¹ˆà¸£à¸°à¸«à¸§à¹ˆà¸²à¸‡à¸”à¸³à¹€à¸™à¸´à¸™à¸à¸²à¸£</option>
Â  Â  Â  Â  Â  <option value="à¸”à¸³à¹€à¸™à¸´à¸™à¸à¸²à¸£à¹à¸¥à¹‰à¸§">à¹€à¸‰à¸à¸²à¸°à¸”à¸³à¹€à¸™à¸´à¸™à¸à¸²à¸£à¹à¸¥à¹‰à¸§</option>
Â  Â  Â  Â  Â  <option value="à¹„à¸¡à¹ˆà¸•à¹ˆà¸­à¸­à¸²à¸¢à¸¸à¹à¸¥à¹‰à¸§">à¹„à¸¡à¹ˆà¸•à¹ˆà¸­à¸­à¸²à¸¢à¸¸à¹à¸¥à¹‰à¸§</option>
Â  Â  Â  Â  </select>
        
        <div style="width: 20px;"></div>
        
        <label>à¸à¸£à¸­à¸‡à¸•à¸²à¸¡à¸›à¸£à¸°à¹€à¸ à¸—à¹ƒà¸šà¸­à¸™à¸¸à¸à¸²à¸•:</label>
Â  Â  Â  Â  <button class="btn-filter" data-filter="à¸œà¸¥à¸´à¸•">âœ… à¹ƒà¸šà¸­à¸™à¸¸à¸à¸²à¸•à¸œà¸¥à¸´à¸• (à¸«à¸¥à¸±à¸)</button>
Â  Â  Â  Â  <button class="btn-filter" data-filter="à¸„à¸£à¸­à¸šà¸„à¸£à¸­à¸‡">ğŸ“˜ à¹ƒà¸šà¸­à¸™à¸¸à¸à¸²à¸•à¸„à¸£à¸­à¸šà¸„à¸£à¸­à¸‡</button>
Â  Â  Â  Â  <button class="btn-filter" data-filter="à¸§à¸±à¸•à¸–à¸¸à¸­à¸±à¸™à¸•à¸£à¸²à¸¢à¸Šà¸™à¸´à¸”à¸—à¸µà¹ˆ 2">âš ï¸ à¹ƒà¸šà¸£à¸±à¸šà¹à¸ˆà¹‰à¸‡à¸Šà¸™à¸´à¸”à¸—à¸µà¹ˆ2</button>
Â  Â  Â  Â  <button class="btn-filter" data-filter="à¸™à¸³à¹€à¸‚à¹‰à¸²">ğŸš¢ à¹ƒà¸šà¸­à¸™à¸¸à¸à¸²à¸•à¸™à¸³à¹€à¸‚à¹‰à¸²</button>
Â  Â  Â  </div>

      <table id="noteTable">
        <thead>
          <tr>
            <th>à¸¥à¸³à¸”à¸±à¸š</th>
            <th>à¸Šà¸·à¹ˆà¸­à¸à¸²à¸£à¸„à¹‰à¸²</th>
            <th>à¸Šà¸·à¹ˆà¸­à¸ªà¸²à¸¡à¸±à¸/à¸ªà¸¹à¸•à¸£</th>
            <th>à¸ªà¸–à¸²à¸™à¸°</th>
            <th>à¸«à¸¡à¸²à¸¢à¹€à¸«à¸•à¸¸</th>
            <th>à¸­à¸±à¸›à¹€à¸”à¸•à¸¥à¹ˆà¸²à¸ªà¸¸à¸”</th>
          </tr>
        </thead>
        <tbody>
          <tr><td colspan="6" style="color:var(--muted)">à¸à¸³à¸¥à¸±à¸‡à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥...</td></tr>
        </tbody>
      </table>
    </div>
  </main>

<script>
const SUPABASE_URL = "https://qmugpalgcktfwixqepti.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFtdWdwYWxnY2t0ZndpeHFlcHRpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg4NzI3NjcsImV4cCI6MjA3NDQ0ODc2N30.cIOCbJAr8_Gbg8d5IxpTQZKVRgl1ETN1hyBgL2_LveA";
// â­ï¸ à¸‚à¹‰à¸­à¸ªà¸³à¸„à¸±à¸: à¹ƒà¸Šà¹‰ Anon Key à¹ƒà¸™à¸«à¸™à¹‰à¸²à¸™à¸µà¹‰à¹„à¸”à¹‰ à¸–à¹‰à¸²à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸² RLS/Permissions à¹ƒà¸™ Supabase à¹ƒà¸«à¹‰ Anon Key à¸­à¹ˆà¸²à¸™à¹„à¸”à¹‰
const sb = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
let allData = [];
let currentFilterFlag = null; // à¸ªà¸–à¸²à¸™à¸°à¸à¸²à¸£à¸à¸£à¸­à¸‡à¸ˆà¸²à¸à¸›à¸¸à¹ˆà¸¡à¹ƒà¸šà¸­à¸™à¸¸à¸à¸²à¸•

function fmtDateBE(d){
Â  if(!d) return '-';
Â  const t = new Date(d);
Â  if(isNaN(t)) return '-';
Â  try{
Â  Â  return t.toLocaleDateString('th-TH-u-ca-buddhist', {
Â  Â  Â  year:'numeric', month:'short', day:'numeric', timeZone:'Asia/Bangkok'
Â  Â  });
Â  }catch{
Â  Â  return `${t.getDate()}/${t.getMonth()+1}/${t.getFullYear()+543}`;
Â  }
}

/* ===== â­ï¸ Flag Detection Functions (à¸„à¸‡à¹„à¸§à¹‰à¸•à¸²à¸¡à¸—à¸µà¹ˆà¸„à¸¸à¸“à¸•à¹‰à¸­à¸‡à¸à¸²à¸£) ===== */
function hasHazard2(text){ return /(à¸§à¸±à¸•à¸–à¸¸à¸­à¸±à¸™à¸•à¸£à¸²à¸¢\s*à¸Šà¸™à¸´à¸”\s*à¸—à¸µà¹ˆ\s*[2à¹’]|à¸Šà¸™à¸´à¸”\s*à¸—à¸µà¹ˆ\s*[2à¹’]|type\s*2)/i.test(String(text||'')); }
function hasPossession(note, licenseNo){
Â  const re = /(à¹ƒà¸š\s*à¸­à¸™à¸¸à¸à¸²à¸•\s*à¸„à¸£à¸­à¸šà¸„à¸£à¸­à¸‡|à¸„à¸£à¸­à¸šà¸„à¸£à¸­à¸‡)/i;
Â  const txt = String(note||'');
Â  const lic = String(licenseNo||'');
Â  if (re.test(txt) || re.test(lic)) return true;
Â  const digitCount = (String(licenseNo||'').match(/\d/g)||[]).length;
Â  if (digitCount >= 16) return true;
Â  return false;
}
function hasImport(note, status){
Â  return /(à¹ƒà¸š\s*à¸­à¸™à¸¸à¸à¸²à¸•\s*à¸™à¸³à¹€à¸‚à¹‰à¸²|à¸™à¸³à¹€à¸‚à¹‰à¸²|Import)/i.test(String(note || status || ''));
}
function hasRegistration(note){
Â  return /(à¹ƒà¸š\s*à¸—à¸°à¹€à¸šà¸µà¸¢à¸™|à¹€à¸¥à¸‚\s*à¸—à¸°à¹€à¸šà¸µà¸¢à¸™)/i.test(String(note||''));
}
function getStickyFlags(row){
Â  const note = row.renewed_note;
  const common = row.common_label;
Â  const licenseNo = row.license_no;
Â  const status = row.renewed_status;
Â  
Â  const now = {
Â  Â  possession: hasPossession(note, licenseNo),
Â  Â  hazard2: Â  hasHazard2(note) || hasHazard2(common) || hasHazard2(row.registration_no),
Â  Â  reg: Â  Â  Â  hasRegistration(note),
Â  Â  import: Â  Â hasImport(note, status),
Â  };
Â  return now;
}


async function loadNotes(){
Â  const params = new URLSearchParams(window.location.search);
Â  const code = params.get('code');
Â  
Â  // â­ï¸ à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸§à¹ˆà¸²à¸¡à¸µà¸£à¸«à¸±à¸ªà¸šà¸£à¸´à¸©à¸±à¸—à¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ
Â  if (!code) {
Â  Â  document.querySelector('#noteTable tbody').innerHTML = `<tr><td colspan="6">à¹„à¸¡à¹ˆà¸à¸šà¸£à¸«à¸±à¸ªà¸šà¸£à¸´à¸©à¸±à¸—à¸—à¸µà¹ˆà¸£à¸°à¸šà¸¸</td></tr>`;
Â  Â  return;
Â  }

Â  document.getElementById('companyName').textContent = `à¸šà¸£à¸´à¸©à¸±à¸—: ${code}`;

Â  // â­ï¸ à¹ƒà¸Šà¹‰ RPC function (à¸ªà¸¡à¸¡à¸•à¸´à¸§à¹ˆà¸²à¸„à¸¸à¸“à¸¡à¸µ RPC function à¹ƒà¸™ Supabase à¸—à¸µà¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¸à¸£à¸­à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹„à¸”à¹‰)
Â  // à¸«à¸£à¸·à¸­à¹ƒà¸Šà¹‰ Select à¸˜à¸£à¸£à¸¡à¸”à¸² à¹à¸•à¹ˆà¸•à¹‰à¸­à¸‡à¸¡à¸±à¹ˆà¸™à¹ƒà¸ˆà¸§à¹ˆà¸² Anon Key à¸¡à¸µà¸ªà¸´à¸—à¸˜à¸´à¹Œà¸­à¹ˆà¸²à¸™à¸•à¸²à¸£à¸²à¸‡
Â  const { data, error } = await sb
Â  Â  .from('product_registrations')
Â  Â  .select('id,brand_name,common_label,registration_no,license_no,renewed_status,renewed_note,renewed_on')
Â  Â  .eq('company_code', code)
Â  Â  .in('renewed_status', ['à¸­à¸¢à¸¹à¹ˆà¸£à¸°à¸«à¸§à¹ˆà¸²à¸‡à¸”à¸³à¹€à¸™à¸´à¸™à¸à¸²à¸£', 'à¸”à¸³à¹€à¸™à¸´à¸™à¸à¸²à¸£à¹à¸¥à¹‰à¸§', 'à¹„à¸¡à¹ˆà¸•à¹ˆà¸­à¸­à¸²à¸¢à¸¸à¹à¸¥à¹‰à¸§'])
Â  Â  .order('renewed_on', { ascending: false });


Â  if(error){
Â  Â  // â­ï¸ à¹à¸ªà¸”à¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡ Error à¸—à¸µà¹ˆà¸Šà¸±à¸”à¹€à¸ˆà¸™
Â  Â  console.error("Supabase Error:", error);
Â  Â  document.querySelector('#noteTable tbody').innerHTML = `<tr><td colspan="6">à¹€à¸à¸´à¸”à¸‚à¹‰à¸­à¸œà¸´à¸”à¸à¸¥à¸²à¸”à¹ƒà¸™à¸à¸²à¸£à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥: ${error.message} (à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸ªà¸´à¸—à¸˜à¸´à¹Œà¸à¸²à¸£à¹€à¸‚à¹‰à¸²à¸–à¸¶à¸‡à¸•à¸²à¸£à¸²à¸‡)</td></tr>`;
Â  Â  return;
Â  }

Â  // â­ï¸ à¸„à¸³à¸™à¸§à¸“ Flags à¹ƒà¸«à¹‰à¹à¸•à¹ˆà¸¥à¸°à¹à¸–à¸§
Â  allData = (data || []).map(r => ({
Â  Â  ...r,
Â  Â  flags: getStickyFlags(r)
Â  }));
Â  renderTable();
}

function renderTable(){
Â  const filterStatus = document.getElementById('statusFilter').value;
Â  let filtered = allData;

Â  // 1. à¸à¸£à¸­à¸‡à¸•à¸²à¸¡à¸ªà¸–à¸²à¸™à¸°à¸«à¸¥à¸±à¸ (Status Filter)
Â  if(filterStatus === 'à¸”à¸³à¹€à¸™à¸´à¸™à¸à¸²à¸£à¸£à¸§à¸¡'){
Â  Â  filtered = allData.filter(r =>
Â  Â  Â  r.renewed_status === 'à¸­à¸¢à¸¹à¹ˆà¸£à¸°à¸«à¸§à¹ˆà¸²à¸‡à¸”à¸³à¹€à¸™à¸´à¸™à¸à¸²à¸£' || r.renewed_status === 'à¸”à¸³à¹€à¸™à¸´à¸™à¸à¸²à¸£à¹à¸¥à¹‰à¸§'
Â  Â  );
Â  } else if(filterStatus !== 'à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”'){
Â  Â  filtered = allData.filter(r => r.renewed_status === filterStatus);
Â  }

  // 2. à¸à¸£à¸­à¸‡à¸•à¸²à¸¡à¸›à¸£à¸°à¹€à¸ à¸—à¹ƒà¸šà¸­à¸™à¸¸à¸à¸²à¸• (Flag Filter)
  if (currentFilterFlag) {
      filtered = filtered.filter(r => {
          const flags = r.flags;
          switch(currentFilterFlag) {
              case 'à¸œà¸¥à¸´à¸•':
                  // à¸œà¸¥à¸´à¸•à¸«à¸¥à¸±à¸: à¸•à¹‰à¸­à¸‡à¹„à¸¡à¹ˆà¸¡à¸µ à¸„à¸£à¸­à¸šà¸„à¸£à¸­à¸‡, à¹„à¸¡à¹ˆà¸¡à¸µ à¸Šà¸™à¸´à¸”2, à¹„à¸¡à¹ˆà¸¡à¸µ à¸™à¸³à¹€à¸‚à¹‰à¸²
                  return !flags.possession && !flags.hazard2 && !flags.import;
              case 'à¸„à¸£à¸­à¸šà¸„à¸£à¸­à¸‡':
                  // à¸–à¸·à¸­à¹€à¸›à¹‡à¸™ 'à¸„à¸£à¸­à¸šà¸„à¸£à¸­à¸‡' à¸—à¸±à¸™à¸—à¸µ
                  return flags.possession;
              case 'à¸§à¸±à¸•à¸–à¸¸à¸­à¸±à¸™à¸•à¸£à¸²à¸¢à¸Šà¸™à¸´à¸”à¸—à¸µà¹ˆ 2':
                  // à¸Šà¸™à¸´à¸”à¸—à¸µà¹ˆ 2: à¸à¹‡à¸•à¹ˆà¸­à¹€à¸¡à¸·à¹ˆà¸­ "à¹„à¸¡à¹ˆà¸¡à¸µ" à¸ªà¸–à¸²à¸™à¸°à¸„à¸£à¸­à¸šà¸„à¸£à¸­à¸‡
                  return flags.hazard2 && !flags.possession;
              case 'à¸™à¸³à¹€à¸‚à¹‰à¸²':
                  return flags.import;
          }
          return false;
      });
  }


Â  const tb = document.querySelector('#noteTable tbody');
Â  if(filtered.length === 0){
Â  Â  tb.innerHTML = `<tr><td colspan="6" style="color:var(--muted)">à¹„à¸¡à¹ˆà¸¡à¸µà¸£à¸²à¸¢à¸à¸²à¸£à¸—à¸µà¹ˆà¸•à¸£à¸‡à¸•à¸²à¸¡à¹€à¸‡à¸·à¹ˆà¸­à¸™à¹„à¸‚à¸à¸²à¸£à¸à¸£à¸­à¸‡à¸™à¸µà¹‰</td></tr>`;
Â  Â  return;
Â  }

Â  tb.innerHTML = filtered.map((r,i)=>{
      const f = r.flags;
      let flagChips = '';
      
      // à¸à¸²à¸£à¹à¸ªà¸”à¸‡à¸œà¸¥: à¹ƒà¸«à¹‰à¹à¸ªà¸”à¸‡à¸›à¹‰à¸²à¸¢à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¸—à¸µà¹ˆà¸•à¸£à¸§à¸ˆà¸ˆà¸±à¸šà¹„à¸”à¹‰
      if (f.possession) flagChips += `<span class="badge-flag flag-possession">ğŸ“˜ à¸„à¸£à¸­à¸šà¸„à¸£à¸­à¸‡</span>`;
      if (f.hazard2) Â  Â flagChips += `<span class="badge-flag flag-hazard2">âš ï¸ à¸Šà¸™à¸´à¸”à¸—à¸µà¹ˆ 2</span>`;
      if (f.import) Â  Â  flagChips += `<span class="badge-flag flag-import">ğŸš¢ à¸™à¸³à¹€à¸‚à¹‰à¸²</span>`;
      if (f.reg) Â  Â  Â  Â flagChips += `<span class="badge-flag flag-reg">ğŸ“‘ à¸—à¸°à¹€à¸šà¸µà¸¢à¸™</span>`;

      let noteContent = r.renewed_note ? r.renewed_note.replace(/\n/g,'<br>') : '-';
      
      return `
Â  Â  <tr data-status="${r.renewed_status}">
Â  Â  Â  <td>${i+1}</td>
Â  Â  Â  <td>${r.brand_name || '-'}</td>
Â  Â  Â  <td>${r.common_label || '-'}</td>
Â  Â  Â  <td><span class="status" data-status="${r.renewed_status}">${r.renewed_status}</span></td>
Â  Â  Â  <td>
          ${flagChips}
          <div style="margin-top: 5px; color: var(--text);">${noteContent}</div>
      </td>
Â  Â  Â  <td>${fmtDateBE(r.renewed_on)}</td>
Â  Â  </tr>
Â  `}).join('');
}

document.addEventListener('DOMContentLoaded', ()=>{
Â  loadNotes();
Â  document.getElementById('statusFilter').addEventListener('change', renderTable);
  
  // Event Listeners à¸ªà¸³à¸«à¸£à¸±à¸šà¸›à¸¸à¹ˆà¸¡à¸à¸£à¸­à¸‡ Flag
  document.querySelectorAll('.btn-filter').forEach(btn => {
      btn.addEventListener('click', (e) => {
          const filterType = e.currentTarget.getAttribute('data-filter');
          const isActive = e.currentTarget.classList.contains('active');
          
          // 1. à¸›à¸£à¸±à¸šà¸ªà¸–à¸²à¸™à¸°à¸›à¸¸à¹ˆà¸¡
          document.querySelectorAll('.btn-filter').forEach(b => b.classList.remove('active'));
          
          if (isActive) {
              // à¸–à¹‰à¸²à¸„à¸¥à¸´à¸à¸‹à¹‰à¸³: à¸¥à¹‰à¸²à¸‡à¸à¸²à¸£à¸à¸£à¸­à¸‡
              currentFilterFlag = null;
          } else {
              // à¸–à¹‰à¸²à¸„à¸¥à¸´à¸à¸›à¸¸à¹ˆà¸¡à¹ƒà¸«à¸¡à¹ˆ: à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²à¸à¸²à¸£à¸à¸£à¸­à¸‡à¹à¸¥à¸°à¹€à¸™à¹‰à¸™à¸›à¸¸à¹ˆà¸¡
              currentFilterFlag = filterType;
              e.currentTarget.classList.add('active');
          }
          
          // 2. à¸à¸£à¸­à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥
          renderTable();
      });
  });
});
</script>
</body>
</html>
