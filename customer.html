<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Customer Portal (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤)</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>

<link href="https://fonts.googleapis.com/css2?family=Prompt:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#f6fbff; --ink:#0f172a; --mut:#64748b; --card:#ffffff; --border:#e6eef5;
    --accent:#0ea5a5; --accent2:#60a5fa; --radius:16px;
    --ok:#065f46; --okbg:#ecfdf5;
    --warn:#b45309; --warnbg:#fff7ed;
    --exp:#b91c1c; --expbg:#fff1f2;
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family:"Prompt",ui-sans-serif,system-ui; color:var(--ink); background:
    radial-gradient(1000px 500px at 10% -10%, #e6f7ff 0%, transparent 60%),
    radial-gradient(900px 450px at 110% 0%, #e8fff6 0%, transparent 60%),
    #f6fbff;
  }
  .wrap{max-width:1200px;margin:22px auto;padding:0 14px}
  .card{
    background:var(--card); border:1px solid var(--border); border-radius:var(--radius);
    padding:18px; box-shadow:0 8px 28px rgba(10,30,60,.06); margin-bottom:14px
  }
  .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
  .spacer{flex:1}
  .mut{color:var(--mut)}
  
  input,button{ padding:12px 14px; border-radius:12px; border:1px solid var(--border); background:#fff; font-size:16px }
  .btn{ cursor:pointer; background:linear-gradient(135deg,var(--accent),var(--accent2)); color:#fff; font-weight:700; border:none }
  .btn-ghost{background:#fff; color:#0e7490; border:1px solid #94d5e5; cursor:pointer;}
  .btn-summary{background:#f0fdfa; color:#0f766e; border:1px solid #5eead4; cursor:pointer; font-weight:700;}

  .stat-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 12px; margin-bottom: 20px; }
  .stat-card { background: #fff; padding: 15px; border-radius: 14px; border: 1px solid var(--border); text-align: center; }
  .stat-val { font-size: 24px; font-weight: 700; color: var(--accent); display: block; }
  .stat-label { font-size: 13px; color: var(--mut); font-weight: 600; }

  table{width:100%; border-collapse:collapse; margin-top:10px; background:#fff; border-radius:12px; overflow:hidden}
  th,td{padding:12px 14px; border-bottom:1px solid var(--border); text-align:left; vertical-align:top; font-size:15px}
  th{background:linear-gradient(180deg,#f7fbff,#f2f8ff); color:#0b3a4f; font-weight:700; position:sticky; top:0; z-index:1}

  .badge{ padding:6px 12px; border-radius:999px; font-size:13px; font-weight:700; display:inline-block }
  .ok{ color:var(--ok); background:var(--okbg); border:1px solid #a7f3d090;}
  .warn{ color:var(--warn); background:var(--warnbg); border:1px solid #fde68a80;}
  .exp{ color:var(--exp); background:var(--expbg); border:1px solid #fecaca90;}

  .flag-base { display: inline-block; padding: 3px 10px; border-radius: 6px; font-weight: 600; font-size: 12px; margin: 2px; border: 1px solid; }
  .flag-combined { background: #f5f3ff; color: #5b21b6; border-color: #ddd6fe; } 
  .flag-possession { background: #eff6ff; color: #1e40af; border-color: #bfdbfe; } 
  .flag-hazard { background: #fffbeb; color: #92400e; border-color: #fde68a; } 

  .note-section { margin-top: 8px; border-top: 1px dashed #e2e8f0; padding-top: 8px; font-size: 13px; color: #475569; }
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <div class="row">
      <div style="font-size:32px">üçØ</div>
      <div>
        <h2 style="margin:0">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡πà‡∏∞‡∏Ñ‡∏∏‡∏ì <span id="headerName">‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</span> üëã</h2>
        <p class="mut" style="margin:0">‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏ô‡πâ‡∏≥‡∏ú‡∏∂‡πâ‡∏á üçØ ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏Ñ‡πà‡∏∞</p>
      </div>
    </div>
    <div class="row" style="margin-top:15px">
      <input id="code" placeholder="‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ ‡πÄ‡∏ä‡πà‡∏ô RG-1234">
      <button class="btn" id="enterBtn">‡πÄ‡∏Ç‡πâ‡∏≤‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
    </div>
    <div id="err" style="color:#b91c1c; margin-top:8px"></div>
  </div>

  <div id="dataCard" style="display:none">
    <div class="stat-grid">
      <div class="stat-card"><span class="stat-label">‚úÖ ‡πÉ‡∏ö‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏ú‡∏•‡∏¥‡∏ï</span><span id="count-‡∏ú‡∏•‡∏¥‡∏ï" class="stat-val">0</span></div>
      <div class="stat-card"><span class="stat-label">üìò ‡πÉ‡∏ö‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏≠‡∏á</span><span id="count-‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏≠‡∏á" class="stat-val">0</span></div>
      <div class="stat-card"><span class="stat-label">‚ö†Ô∏è ‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏ú‡∏•‡∏¥‡∏ï ‡∏ä‡∏ô‡∏¥‡∏î‡∏ó‡∏µ‡πà 2</span><span id="count-‡∏ä‡∏ô‡∏¥‡∏î2" class="stat-val">0</span></div>
      <div class="stat-card"><span class="stat-label">üü£ ‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏≠‡∏á ‡∏ä‡∏ô‡∏¥‡∏î‡∏ó‡∏µ‡πà2</span><span id="count-‡∏£‡∏ß‡∏°" class="stat-val">0</span></div>
    </div>

    <div class="card">
      <div class="row">
        <div>
          <div class="mut">‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</div>
          <div id="companyName" style="font-weight:700; font-size:20px"></div>
        </div>
        <div class="spacer"></div>
        <input id="q" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤/‡πÄ‡∏•‡∏Ç‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô..." style="min-width:260px">
        <button class="btn" id="refreshBtn">‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä</button>
        <button class="btn-summary" id="toSummaryBtn">‡∏î‡∏π‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
      </div>

      <div class="row" style="margin-top:15px; gap:8px">
        <div class="mut" style="font-weight:600">‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:</div>
        <button class="btn-ghost filter-btn" data-filter="‡∏ú‡∏•‡∏¥‡∏ï">‚úÖ ‡πÉ‡∏ö‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏ú‡∏•‡∏¥‡∏ï</button>
        <button class="btn-ghost filter-btn" data-filter="‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏≠‡∏á">üìò ‡πÉ‡∏ö‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏≠‡∏á</button>
        <button class="btn-ghost filter-btn" data-filter="‡∏ä‡∏ô‡∏¥‡∏î2">‚ö†Ô∏è ‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏ú‡∏•‡∏¥‡∏ï ‡∏ä‡∏ô‡∏¥‡∏î‡∏ó‡∏µ‡πà2</button>
        <button class="btn-ghost filter-btn" data-filter="‡∏£‡∏ß‡∏°">üü£ ‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏≠‡∏á ‡∏ä‡∏ô‡∏¥‡∏î‡∏ó‡∏µ‡πà2</button>
        <button class="btn-ghost filter-btn" data-filter="‡∏õ‡∏±‡∏ç‡∏´‡∏≤">üöß ‡∏ï‡∏¥‡∏î‡∏õ‡∏±‡∏ç‡∏´‡∏≤</button>
      </div>

      <table>
        <thead>
          <tr>
            <th>‡∏•‡∏≥‡∏î‡∏±‡∏ö</th>
            <th>‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤ / ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏°‡∏±‡∏ç</th>
            <th>‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô / ‡πÉ‡∏ö‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï</th>
            <th>‡∏ß‡∏±‡∏ô‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏</th>
            <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÅ‡∏•‡∏∞‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>
  </div>
</div>

<script>
const SUPABASE_URL = "https://qmugpalgcktfwixqepti.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFtdWdwYWxnY2t0ZndpeHFlcHRpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg4NzI3NjcsImV4cCI6MjA3NDQ0ODc2N30.cIOCbJAr8_Gbg8d5IxpTQZKVRgl1ETN1hyBgL2_LveA";
const sb = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

const $ = (id)=> document.getElementById(id);
let FULL_ROWS = [], FILTERED = [], CURRENT_FILTER = null;

function fmtDateBE(d){
  if(!d) return '-';
  const t = new Date(d);
  return t.toLocaleDateString('th-TH-u-ca-buddhist', { year:'numeric', month:'long', day:'numeric' });
}

function getCategory(row){
  const text = (row.renewed_note || '').toLowerCase() + ' ' + (row.license_no || '').toLowerCase();
  const hasPossession = text.includes('‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏≠‡∏á');
  const hasHazard = text.includes('‡∏ä‡∏ô‡∏¥‡∏î‡∏ó‡∏µ‡πà 2') || text.includes('‡∏ä‡∏ô‡∏¥‡∏î‡∏ó‡∏µ‡πà2');
  if(hasPossession && hasHazard) return '‡∏£‡∏ß‡∏°';
  if(hasPossession) return '‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏≠‡∏á';
  if(hasHazard) return '‡∏ä‡∏ô‡∏¥‡∏î2';
  return '‡∏ú‡∏•‡∏¥‡∏ï';
}

function updateCounters(){
  const counts = { ‡∏ú‡∏•‡∏¥‡∏ï:0, ‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏≠‡∏á:0, ‡∏ä‡∏ô‡∏¥‡∏î2:0, ‡∏£‡∏ß‡∏°:0 };
  FULL_ROWS.forEach(r => {
    const cat = getCategory(r);
    if(counts[cat] !== undefined) counts[cat]++;
  });
  $('count-‡∏ú‡∏•‡∏¥‡∏ï').textContent = counts.‡∏ú‡∏•‡∏¥‡∏ï;
  $('count-‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏≠‡∏á').textContent = counts.‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏≠‡∏á;
  $('count-‡∏ä‡∏ô‡∏¥‡∏î2').textContent = counts.‡∏ä‡∏ô‡∏¥‡∏î2;
  $('count-‡∏£‡∏ß‡∏°').textContent = counts.‡∏£‡∏ß‡∏°;
}

function statusBadge(row){
  const st = row.renewed_status || '';
  if(st.includes('‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß')) return '<span class="badge ok">‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß</span>'; 

  let dayBadge = '';
  if(row.expiry_date) {
    const diff = Math.ceil((new Date(row.expiry_date) - new Date())/86400000);
    if(diff < 0) dayBadge = '<span class="badge exp">‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏</span>';
    else if(diff <= 90) dayBadge = `<span class="badge warn">‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ${diff} ‡∏ß‡∏±‡∏ô</span>`;
    else dayBadge = '<span class="badge ok">‡∏õ‡∏Å‡∏ï‡∏¥</span>';
  } else {
    dayBadge = '<span class="badge ok">‡∏õ‡∏Å‡∏ï‡∏¥</span>';
  }

  if(st === '‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤'){
    return `<span class="badge warn" style="background:#fef3c7; color:#92400e; border:1px solid #fcd34d">üì¢ ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö</span> ${dayBadge}`;
  }
  if(st === '‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠‡∏≠‡∏≤‡∏¢‡∏∏'){
    return `<span class="badge ok" style="background:#e0f2fe; color:#075985; border:1px solid #bae6fd">üìÑ ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß</span> ${dayBadge}`;
  }
  return dayBadge;
}

function render(){
  const tb = $('tbody');
  tb.innerHTML = FILTERED.map((r,i)=>{
    const cat = getCategory(r);
    let chips = '';
    if(cat === '‡∏£‡∏ß‡∏°') chips = '<span class="flag-base flag-combined">‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏≠‡∏á ‡∏ä‡∏ô‡∏¥‡∏î‡∏ó‡∏µ‡πà 2</span>';
    else if(cat === '‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏≠‡∏á') chips = '<span class="flag-base flag-possession">üìò ‡πÉ‡∏ö‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏≠‡∏á</span>';
    else if(cat === '‡∏ä‡∏ô‡∏¥‡∏î2') chips = '<span class="flag-base flag-hazard">‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏ú‡∏•‡∏¥‡∏ï ‡∏ä‡∏ô‡∏¥‡∏î‡∏ó‡∏µ‡πà 2</span>';

    return `
      <tr>
        <td>${i+1}</td>
        <td><b>${r.brand_name}</b><br><small class="mut">${r.common_label}</small></td>
        <td>‡∏ó‡∏ö: ${r.registration_no||'-'}<br><small style="color:var(--accent)">‡πÉ‡∏ö‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï: ${r.license_no||'-'}</small></td>
        <td>${fmtDateBE(r.expiry_date)}</td>
        <td>
          ${statusBadge(r)} ${chips}
          <div class="note-section" style="white-space: pre-line; ${r.renewed_status?.includes('‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß') ? 'color:#059669; font-weight:600;' : ''}">
            ${r.renewed_note ? r.renewed_note.split('\n').map(line => `<div>‚Ä¢ ${line.trim()}</div>`).join('') : '<span class="mut" style="font-size:11px;">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</span>'}
          </div>
        </td>
      </tr>
    `;
  }).join('');
}

function applyFilter(){
  const search = ($('q').value || '').toLowerCase();
  FILTERED = FULL_ROWS.filter(r => {
    const cat = getCategory(r);
    const text = (r.brand_name + r.common_label + r.registration_no + r.license_no + (r.renewed_note||'')).toLowerCase();
    let passFilter = true;
    if(CURRENT_FILTER) {
      if(CURRENT_FILTER === '‡∏õ‡∏±‡∏ç‡∏´‡∏≤') passFilter = text.includes('‡∏õ‡∏±‡∏ç‡∏´‡∏≤');
      else passFilter = (cat === CURRENT_FILTER);
    }
    return passFilter && text.includes(search);
  });
  render();
}

// --- ‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ---
async function loadData(){
  const code = ($('code').value || '').trim().toUpperCase();
  if(!code) return ($('err').textContent = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤');
  
  $('err').textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏´‡∏±‡∏™...';
  
  // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Portal ‡∏°‡∏≤‡∏Å‡πà‡∏≠‡∏ô
  const { data, error: dataErr } = await sb.rpc('get_company_portal', { p_plain_code: code });
  
  if(dataErr || !data || data.length === 0) {
    $('err').textContent = '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ô‡∏µ‡πâ ‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö';
    $('dataCard').style.display = 'none';
    return;
  }

  // ‡∏î‡∏∂‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏à‡∏≤‡∏Å column company_name (‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡πÅ‡∏Å‡πâ SQL ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô name_text ‡πÅ‡∏•‡πâ‡∏ß)
  const realName = data[0].company_name || "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó";

  $('companyName').textContent = realName;
  $('headerName').textContent = realName; // ‡πÅ‡∏™‡∏î‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏£‡∏á‡∏Ñ‡∏≥‡∏ó‡∏±‡∏Å‡∏ó‡∏≤‡∏¢‡∏Ç‡πâ‡∏≤‡∏á‡∏ö‡∏ô‡∏î‡πâ‡∏ß‡∏¢

  FULL_ROWS = data || [];
  $('dataCard').style.display = 'block';
  $('err').textContent = '';
  updateCounters();
  applyFilter();
}

document.querySelectorAll('.filter-btn').forEach(btn => {
  btn.addEventListener('click', (e) => {
    const f = e.target.dataset.filter;
    CURRENT_FILTER = (CURRENT_FILTER === f) ? null : f;
    document.querySelectorAll('.filter-btn').forEach(b => b.classList.replace('btn', 'btn-ghost'));
    if(CURRENT_FILTER) e.target.classList.replace('btn-ghost', 'btn');
    applyFilter();
  });
});

$('toSummaryBtn').addEventListener('click', () => {
  const code = ($('code').value || '').trim().toUpperCase();
  if(!code) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏Å‡πà‡∏≠‡∏ô');
  location.href = `summary.html?code=${encodeURIComponent(code)}`;
});

$('enterBtn').addEventListener('click', loadData);
$('refreshBtn').addEventListener('click', loadData);
$('q').addEventListener('input', applyFilter);
</script>
</body>
</html>
