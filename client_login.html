<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8">
  <title>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    body {
      font-family: "Prompt", "Inter", sans-serif;
      margin: 0; padding: 0;
      min-height: 100vh;
      display: flex; align-items: center; justify-content: center;
      background: linear-gradient(135deg, #06b6d4, #10b981);
    }
    .login-box {
      background: rgba(255,255,255,0.95);
      padding: 40px;
      border-radius: 16px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.25);
      max-width: 380px;
      width: 100%;
      text-align: center;
    }
    h1 {
      font-size: 22px;
      margin-bottom: 20px;
      color: #065f46;
    }
    input {
      width: 100%;
      padding: 12px;
      margin: 12px 0;
      border-radius: 10px;
      border: 1px solid #ccc;
      font-size: 16px;
      box-sizing: border-box;
    }
    button {
      width: 100%;
      padding: 12px;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      background: linear-gradient(135deg, #0ea5e9, #10b981);
      color: white;
      transition: 0.2s;
      margin-top: 8px;
    }
    button:hover {
      background: linear-gradient(135deg, #0284c7, #059669);
    }
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    .msg {
      margin-top: 15px;
      font-size: 14px;
      color: #065f46;
      padding: 10px;
      border-radius: 8px;
    }
    .msg.error {
      background: #fee;
      color: #c00;
    }
    .msg.success {
      background: #efe;
      color: #060;
    }
    .tab-btn {
      width: 48%;
      padding: 10px;
      margin: 0 1%;
      border: 2px solid #0ea5e9;
      border-radius: 8px;
      background: white;
      color: #0ea5e9;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: 0.2s;
    }
    .tab-btn.active {
      background: linear-gradient(135deg, #0ea5e9, #10b981);
      color: white;
      border-color: transparent;
    }
    .tab-btn:hover {
      transform: translateY(-2px);
    }
    .tab-content {
      display: none;
      margin-top: 20px;
    }
    .tab-content.active {
      display: block;
    }
  </style>
</head>
<body>
  <div class="login-box">
    <h1>üîê ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</h1>
    
    <div style="margin-bottom: 20px;">
      <button class="tab-btn active" onclick="switchTab('password')">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</button>
      <button class="tab-btn" onclick="switchTab('magic')">Magic Link</button>
    </div>

    <!-- Password Login Tab -->
    <div id="passwordTab" class="tab-content active">
      <p>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡πâ‡∏ß‡∏¢‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏•‡∏∞‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</p>
      <input type="email" id="emailPassword" placeholder="example@company.com" />
      <input type="password" id="password" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" />
      <button id="btnPassword" onclick="loginPassword()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
    </div>

    <!-- Magic Link Tab -->
    <div id="magicTab" class="tab-content">
      <p>‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</p>
      <input type="email" id="emailMagic" placeholder="example@company.com" />
      <button id="btnMagic" onclick="loginMagic()">‡∏™‡πà‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå</button>
    </div>

    <div class="msg" id="msg"></div>
    
    <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #e5e7eb; font-size: 14px; color: #6b7280;">
      ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ? <a href="/signup.html" style="color: #0ea5e9; text-decoration: none; font-weight: 600;">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</a>
    </div>
  </div>

<script>
const SUPABASE_URL = "https://qmugpalgcktfwixqepti.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFtdWdwYWxnY2t0ZndpeHFlcHRpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg4NzI3NjcsImV4cCI6MjA3NDQ0ODc2N30.cIOCbJAr8_Gbg8d5IxpTQZKVRgl1ETN1hyBgL2_LveA";
const client = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

function switchTab(tab) {
  const magicTab = document.getElementById("magicTab");
  const passwordTab = document.getElementById("passwordTab");
  const tabs = document.querySelectorAll(".tab-btn");
  const msgBox = document.getElementById("msg");
  
  msgBox.textContent = "";
  msgBox.className = "msg";
  
  if (tab === 'magic') {
    magicTab.classList.add("active");
    passwordTab.classList.remove("active");
    tabs[0].classList.remove("active");
    tabs[1].classList.add("active");
  } else {
    magicTab.classList.remove("active");
    passwordTab.classList.add("active");
    tabs[0].classList.add("active");
    tabs[1].classList.remove("active");
  }
}

async function loginMagic() {
  const email = document.getElementById("emailMagic").value.trim();
  const msgBox = document.getElementById("msg");
  const btn = document.getElementById("btnMagic");
  
  if (!email) {
    msgBox.textContent = "‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•";
    msgBox.className = "msg error";
    return;
  }
  
  btn.disabled = true;
  msgBox.textContent = "‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå...";
  msgBox.className = "msg";
  
  try {
    const { error } = await client.auth.signInWithOtp({
      email: email,
      options: { 
        emailRedirectTo: window.location.origin + "/customer.html" 
      }
    });
    
    if (error) throw error;
    
    msgBox.textContent = "‚úÖ ‡∏™‡πà‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏à‡∏î‡∏´‡∏°‡∏≤‡∏¢";
    msgBox.className = "msg success";
  } catch (err) {
    msgBox.textContent = "‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + err.message;
    msgBox.className = "msg error";
    console.error("Magic link error:", err);
  } finally {
    btn.disabled = false;
  }
}

async function loginPassword() {
  const email = document.getElementById("emailPassword").value.trim();
  const password = document.getElementById("password").value;
  const msgBox = document.getElementById("msg");
  const btn = document.getElementById("btnPassword");
  
  if (!email || !password) {
    msgBox.textContent = "‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏•‡∏∞‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô";
    msgBox.className = "msg error";
    return;
  }
  
  btn.disabled = true;
  msgBox.textContent = "‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö...";
  msgBox.className = "msg";
  
  try {
    const { data, error } = await client.auth.signInWithPassword({
      email: email,
      password: password
    });
    
    if (error) throw error;
    
    console.log("Login success:", data);
    msgBox.textContent = "‚úÖ ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏ô‡πâ‡∏≤...";
    msgBox.className = "msg success";
    
    // Redirect ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ customer portal
    setTimeout(() => {
      window.location.href = "/customer.html";
    }, 1000);
    
  } catch (err) {
    msgBox.textContent = "‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + err.message;
    msgBox.className = "msg error";
    console.error("Password login error:", err);
    btn.disabled = false;
  }
}

// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ session ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
async function checkExistingSession() {
  const { data: { session } } = await client.auth.getSession();
  if (session) {
    console.log("Already logged in, redirecting...");
    window.location.href = "/customer.html";
  }
}

// ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ï‡∏≠‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤
document.addEventListener('DOMContentLoaded', checkExistingSession);

// ‡∏£‡∏±‡∏ö callback ‡∏à‡∏≤‡∏Å Magic Link
client.auth.onAuthStateChange((event, session) => {
  console.log("Auth state changed:", event, session);
  if (event === 'SIGNED_IN' && session) {
    window.location.href = "/customer.html";
  }
});
</script>
</body>
</html>
